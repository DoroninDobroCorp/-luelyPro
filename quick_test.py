#!/usr/bin/env python3
"""
–ë—ã—Å—Ç—Ä—ã–π —Ç–µ—Å—Ç –Ω–∞ 10 —Å–µ–∫—É–Ω–¥ - –ë–ï–ó –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–∞.
–ü—Ä–æ—Å—Ç–æ –∑–∞–ø—É—Å–∫–∞–µ—Ç —Å–∏—Å—Ç–µ–º—É –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —á—Ç–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å.
"""
import os
import sys
import subprocess
from pathlib import Path
from loguru import logger

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
logger.remove()
logger.add(sys.stderr, level="INFO", format="<green>{time:HH:mm:ss}</green> | <level>{level:8}</level> | {message}")

logger.info("=" * 80)
logger.info("–ë–´–°–¢–†–´–ô –¢–ï–°–¢: 20 —Å–µ–∫—É–Ω–¥ —Ä–∞–±–æ—Ç—ã —Å–∏—Å—Ç–µ–º—ã")
logger.info("=" * 80)
logger.info("")

# –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø—Ä–æ—Ñ–∏–ª–∏
profiles = list(Path("profiles").glob("*.npz"))

if not profiles:
    logger.error("‚ùå –ù–ï–¢ –ü–†–û–§–ò–õ–ï–ô!")
    logger.error("   –°–æ–∑–¥–∞–π: ./run.sh enroll")
    sys.exit(1)

logger.info(f"–ò—Å–ø–æ–ª—å–∑—É–µ–º –ø—Ä–æ—Ñ–∏–ª—å: {profiles[0].name}")
logger.info("")

logger.info("üìã –ß–¢–û –î–ï–õ–ê–¢–¨:")
logger.info("  1. –°–∏—Å—Ç–µ–º–∞ –∑–∞–ø—É—Å—Ç–∏—Ç—Å—è –Ω–∞ 20 —Å–µ–∫—É–Ω–¥")
logger.info("  2. –ü—É—Å—Ç—å –∫—Ç–æ-—Ç–æ –∑–∞–¥–∞—Å—Ç –≤–æ–ø—Ä–æ—Å (–∏–ª–∏ –≤–∫–ª—é—á–∏ –≤–∏–¥–µ–æ)")
logger.info("  3. –î–æ–∂–¥–∏—Å—å —Ç–µ–∑–∏—Å–∞")
logger.info("  4. –û–¢–í–ï–¢–¨ –ì–†–û–ú–ö–û –∫–æ–≥–¥–∞ —É—Å–ª—ã—à–∏—à—å –ø–æ–≤—Ç–æ—Ä")
logger.info("")

logger.info("üìù –ü–†–ò–ú–ï–†:")
logger.info("  –í–æ–ø—Ä–æ—Å: '–ö–æ–≥–¥–∞ –æ—Ç–º–µ–Ω–∏–ª–∏ —Ä–∞–±—Å—Ç–≤–æ?'")
logger.info("  –°–∏—Å—Ç–µ–º–∞: '–í 1865 –≥–æ–¥—É...' (–ø–æ–≤—Ç–æ—Ä—è–µ—Ç)")
logger.info("  –¢–´: '–í 1865 –≥–æ–¥—É'")
logger.info("  –û–∂–∏–¥–∞–µ–º: '–¢–µ–∑–∏—Å –∑–∞–∫—Ä—ã—Ç' ‚úÖ")
logger.info("")

logger.info("üöÄ –ó–ê–ü–£–°–ö –ß–ï–†–ï–ó 3 –°–ï–ö–£–ù–î–´...")
import time
for i in range(3, 0, -1):
    logger.info(f"   {i}...")
    time.sleep(1)

logger.info("")
logger.info("‚ñ∂ –ó–ê–ü–£–©–ï–ù–û! –ì–æ–≤–æ—Ä–∏—Ç–µ –≤ –º–∏–∫—Ä–æ—Ñ–æ–Ω!")
logger.info("")

# –ó–∞–ø—É—Å–∫–∞–µ–º —Å ASR –∏ LLM
result = subprocess.run(
    [".venv/bin/python", "main.py", "live", 
     "--profile", str(profiles[0]),
     "--asr",  # –í–∫–ª—é—á–∞–µ–º ASR!
     "--llm"   # –í–∫–ª—é—á–∞–µ–º LLM!
    ],
    env={**os.environ, "RUN_SECONDS": "20", "THESIS_REPEAT_SEC": "5"}
)

logger.info("")
logger.info("=" * 80)
logger.info("–¢–ï–°–¢ –ó–ê–í–ï–†–®–Å–ù")
logger.info("=" * 80)
logger.info("")

logger.info("üîç –ü–†–û–í–ï–†–¨ –õ–û–ì–ò –í–´–®–ï - –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å:")
logger.info("")
logger.info("  ‚úÖ '–Ω–µ–∑–Ω–∞–∫–æ–º—ã–π –≥–æ–ª–æ—Å (ASR): –≤–æ–ø—Ä–æ—Å' - –≤–æ–ø—Ä–æ—Å —Ä–∞—Å–ø–æ–∑–Ω–∞–Ω")
logger.info("  ‚úÖ '–û—Ç–≤–µ—Ç: ...' - LLM –æ—Ç–≤–µ—Ç–∏–ª")
logger.info("  ‚úÖ '–¢–µ–∑–∏—Å (–∏–∑ –æ—Ç–≤–µ—Ç–∞): ...' - —Ç–µ–∑–∏—Å —Å–æ–∑–¥–∞–Ω (–µ—Å–ª–∏ –Ω–µ '–Ω–µ —è—Å–µ–Ω')")
logger.info("  ‚úÖ '–¢–µ–∑–∏—Å: ...' - —Ç–µ–∑–∏—Å –æ–±—ä—è–≤–ª–µ–Ω")
logger.info("")
logger.info("  üéØ –ì–õ–ê–í–ù–û–ï:")
logger.info("  ‚úÖ '–º–æ–π –≥–æ–ª–æ—Å' - –¢–´ —Ä–∞—Å–ø–æ–∑–Ω–∞–Ω (–∫–æ–≥–¥–∞ –æ—Ç–≤–µ—á–∞–ª)")
logger.info("  ‚úÖ '–ú–æ—è —Ä–µ—á—å (ASR): —Ç–≤–æ–π –æ—Ç–≤–µ—Ç' - —Ç–≤–æ–π –æ—Ç–≤–µ—Ç —Ä–∞—Å–ø–æ–∑–Ω–∞–Ω")
logger.info("  ‚úÖ '–ü—Ä–æ–≥—Ä–µ—Å—Å —Ç–µ–∫—É—â–µ–≥–æ —Ç–µ–∑–∏—Å–∞: XX%' - –ø–æ–∫–∞–∑–∞–Ω –ø—Ä–æ–≥—Ä–µ—Å—Å")
logger.info("  ‚úÖ '–¢–µ–∑–∏—Å –∑–∞–∫—Ä—ã—Ç' - —Ç–µ–∑–∏—Å –∑–∞–∫—Ä—ã—Ç!")
logger.info("")

logger.info("‚ùå –ï–°–õ–ò –ù–ï–¢ '–º–æ–π –≥–æ–ª–æ—Å':")
logger.info("   ‚Üí –ü—Ä–æ—Ñ–∏–ª—å –Ω–µ –ø–æ–¥—Ö–æ–¥–∏—Ç –∏–ª–∏ threshold —Å–ª–∏—à–∫–æ–º —Å—Ç—Ä–æ–≥–∏–π")
logger.info("   ‚Üí –ü–µ—Ä–µ—Å–æ–∑–¥–∞–π: ./run.sh enroll")
logger.info("   ‚Üí –ò–ª–∏ —É–≤–µ–ª–∏—á—å threshold –≤ .env: VOICE_THRESHOLD=0.85")
logger.info("")

logger.info("‚ùå –ï–°–õ–ò –ù–ï–¢ '–¢–µ–∑–∏—Å –∑–∞–∫—Ä—ã—Ç':")
logger.info("   ‚Üí –ü–æ—Ä–æ–≥ —Å–ª–∏—à–∫–æ–º —Å—Ç—Ä–æ–≥–∏–π –∏–ª–∏ –º–∞–ª–æ —Å–ª–æ–≤ —Å–æ–≤–ø–∞–ª–æ")
logger.info("   ‚Üí –°–Ω–∏–∑—å –ø–æ—Ä–æ–≥ –≤ .env: THESIS_MATCH_THRESHOLD=0.2")
logger.info("   ‚Üí –ò–ª–∏ –æ—Ç–≤–µ—á–∞–π –ë–û–õ–¨–®–ï —Å–ª–æ–≤ –∏–∑ —Ç–µ–∑–∏—Å–∞")
logger.info("")

sys.exit(result.returncode)
